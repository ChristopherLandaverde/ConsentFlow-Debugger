<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Real Events Test - GTM Consent Inspector</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            line-height: 1.6;
        }
        .test-section {
            background: #f5f5f5;
            padding: 20px;
            margin: 20px 0;
            border-radius: 8px;
        }
        .test-button {
            background: #007cba;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 4px;
            cursor: pointer;
            margin: 5px;
        }
        .test-button:hover {
            background: #005a87;
        }
        .status {
            padding: 10px;
            margin: 10px 0;
            border-radius: 4px;
        }
        .status.success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }
        .status.error {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }
        .status.info {
            background: #d1ecf1;
            color: #0c5460;
            border: 1px solid #bee5eb;
        }
        #eventLog {
            background: #f8f9fa;
            border: 1px solid #dee2e6;
            border-radius: 4px;
            padding: 15px;
            margin: 20px 0;
            max-height: 400px;
            overflow-y: auto;
        }
        .event-item {
            background: white;
            border: 1px solid #dee2e6;
            border-radius: 4px;
            padding: 10px;
            margin: 5px 0;
            font-family: monospace;
            font-size: 12px;
        }
    </style>
</head>
<body>
    <h1>üß™ Real Events Test - GTM Consent Inspector</h1>
    
    <div class="status info">
        <strong>Test Instructions:</strong> This page tests the real event capture functionality. 
        Open the GTM Consent Inspector extension and check the Events tab to see real events being captured.
    </div>

    <div class="test-section">
        <h2>1. Cookiebot Events Test</h2>
        <p>Simulate Cookiebot consent events:</p>
        <button class="test-button" onclick="triggerCookiebotAccept()">Trigger Cookiebot Accept</button>
        <button class="test-button" onclick="triggerCookiebotDecline()">Trigger Cookiebot Decline</button>
        <button class="test-button" onclick="triggerCookiebotConsentReady()">Trigger Cookiebot Consent Ready</button>
        <button class="test-button" onclick="triggerCookiebotDialogDisplay()">Trigger Cookiebot Dialog Display</button>
    </div>

    <div class="test-section">
        <h2>2. DataLayer Events Test</h2>
        <p>Simulate dataLayer.push events:</p>
        <button class="test-button" onclick="triggerDataLayerEvent()">Trigger dataLayer.push Event</button>
        <button class="test-button" onclick="triggerConsentUpdate()">Trigger Consent Update</button>
        <button class="test-button" onclick="triggerPageView()">Trigger Page View</button>
    </div>

    <div class="test-section">
        <h2>3. GTag Events Test</h2>
        <p>Simulate gtag consent updates:</p>
        <button class="test-button" onclick="triggerGtagConsentUpdate()">Trigger gtag Consent Update</button>
    </div>

    <div class="test-section">
        <h2>4. Real-time Event Log</h2>
        <p>Events captured on this page:</p>
        <div id="eventLog">
            <div class="event-item">Waiting for events...</div>
        </div>
        <button class="test-button" onclick="refreshEventLog()">üîÑ Refresh Event Log</button>
        <button class="test-button" onclick="clearEventLog()">üóëÔ∏è Clear Event Log</button>
    </div>

    <script>
        // Mock Cookiebot for testing
        window.Cookiebot = {
            consent: {
                statistics: false,
                marketing: false,
                necessary: true,
                preferences: false
            }
        };

        // Mock dataLayer
        window.dataLayer = [];

        // Mock gtag
        window.gtag = function() {
            console.log('gtag called with:', arguments);
        };

        // Test functions
        function triggerCookiebotAccept() {
            const event = new CustomEvent('CookiebotOnAccept', {
                detail: 'all'
            });
            window.dispatchEvent(event);
            addEventToLog('Cookiebot Accept Event', 'cookiebot_native');
        }

        function triggerCookiebotDecline() {
            const event = new CustomEvent('CookiebotOnDecline', {
                detail: 'none'
            });
            window.dispatchEvent(event);
            addEventToLog('Cookiebot Decline Event', 'cookiebot_native');
        }

        function triggerCookiebotConsentReady() {
            const event = new CustomEvent('CookiebotOnConsentReady', {
                detail: {
                    statistics: true,
                    marketing: false,
                    necessary: true,
                    preferences: true
                }
            });
            window.dispatchEvent(event);
            addEventToLog('Cookiebot Consent Ready Event', 'cookiebot_native');
        }

        function triggerCookiebotDialogDisplay() {
            const event = new CustomEvent('CookiebotOnDialogDisplay', {
                detail: 'preferences'
            });
            window.dispatchEvent(event);
            addEventToLog('Cookiebot Dialog Display Event', 'cookiebot_native');
        }

        function triggerDataLayerEvent() {
            window.dataLayer.push({
                event: 'test_event',
                category: 'test',
                action: 'click',
                label: 'test_button'
            });
            addEventToLog('DataLayer Push Event', 'datalayer');
        }

        function triggerConsentUpdate() {
            window.dataLayer.push(['consent', 'update', {
                analytics_storage: 'granted',
                ad_storage: 'denied',
                functionality_storage: 'granted'
            }]);
            addEventToLog('Consent Update Event', 'datalayer');
        }

        function triggerPageView() {
            window.dataLayer.push({
                event: 'page_view',
                page_title: 'Test Page',
                page_location: window.location.href
            });
            addEventToLog('Page View Event', 'datalayer');
        }

        function triggerGtagConsentUpdate() {
            window.gtag('consent', 'update', {
                analytics_storage: 'granted',
                ad_storage: 'granted',
                functionality_storage: 'granted'
            });
            addEventToLog('GTag Consent Update Event', 'gtag');
        }

        function addEventToLog(eventName, source) {
            const eventLog = document.getElementById('eventLog');
            const eventItem = document.createElement('div');
            eventItem.className = 'event-item';
            eventItem.innerHTML = `
                <strong>${eventName}</strong><br>
                <small>Source: ${source} | Time: ${new Date().toLocaleTimeString()}</small>
            `;
            eventLog.appendChild(eventItem);
            eventLog.scrollTop = eventLog.scrollHeight;
        }

        function refreshEventLog() {
            // This would typically call the extension's API
            addEventToLog('Manual Refresh', 'user_action');
        }

        function clearEventLog() {
            document.getElementById('eventLog').innerHTML = '<div class="event-item">Event log cleared</div>';
        }

        // Auto-trigger some events on page load
        window.addEventListener('load', function() {
            setTimeout(() => {
                triggerCookiebotConsentReady();
            }, 1000);
            
            setTimeout(() => {
                triggerPageView();
            }, 2000);
        });
    </script>
</body>
</html>